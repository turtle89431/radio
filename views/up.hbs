<script src="/socket.io/socket.io.js"></script>
<script>
    var port = '//:' + {{ port }}
    console.log(port)
    var socket = io(port);
    var constraints = { audio: true };
    navigator.mediaDevices.getUserMedia(constraints).then(function (mediaStream) {
        var mediaRecorder = new MediaRecorder(mediaStream);
        console.log(mediaStream)
        mediaRecorder.onstart = function (e) {
            this.chunks = [];
        };
        mediaRecorder.ondataavailable = function (e) {
            this.chunks.push(e.data);
            //socket.emit('radio', e.data);
        };
        mediaRecorder.onstop = function (e) {
            var blob = new Blob(this.chunks, { 'type': 'audio/ogg; codecs=opus' });
            socket.emit('rec', blob);
        };

        // Start recording
        mediaRecorder.start();
console.log(mediaRecorder)
        // Stop recording after 5 seconds and broadcast it to server
        setInterval(function () {
            mediaRecorder.stop()
            mediaRecorder.start()

        }, 1000);

    });
</script>